import { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Progress } from "@/components/ui/progress";

const questions = [
  { question: "Which ancient kingdom in Assam was known for its capital at Pragjyotishpura?", answer: "Kamarupa Kingdom" },
  { question: "The Moamoria Rebellion significantly weakened which dynasty in Assam?", answer: "Ahom Dynasty" },
  { question: "Who was the first Assamese to be elected as the President of the Indian National Congress?", answer: "Anandaram Dhekial Phukan" },
  { question: "Which treaty ended the First Anglo-Burmese War and ceded Assam to British India?", answer: "Treaty of Yandabo" },
  { question: "Who was the first Assamese woman to be elected to the Lok Sabha?", answer: "Renuka Devi Barkataki" },
  { question: "Who composed the state song of Assam, \"O Mur Apunar Desh\"?", answer: "Lakshminath Bezbaroa" },
  { question: "What is the Bihu festival primarily associated with?", answer: "Agriculture" },
  { question: "Which Assamese leader is also known as the 'Iron Man of Assam'?", answer: "Gopinath Bordoloi" },
  { question: "In which year was Assam separated from Bengal to become a Chief Commissioner's Province?", answer: "1874" },
  { question: "Which river island in Assam is considered the world's largest?", answer: "Majuli" },
  { question: "What is the capital of Assam?", answer: "Dispur" },
  { question: "What is the primary gas responsible for the greenhouse effect on Earth?", answer: "Carbon Dioxide" },
  { question: "Which part of the human brain is responsible for regulating balance and coordination?", answer: "Cerebellum" },
  { question: "What is the SI unit of electric current?", answer: "Ampere" },
  { question: "Which planet in our solar system has the most moons?", answer: "Saturn" },
  { question: "What is the process by which plants release water vapor into the atmosphere?", answer: "Transpiration" },
  { question: "Who is the current Chief Minister of Assam?", answer: "Himanta Biswa Sarma" },
  { question: "Which Indian city hosted the G20 Summit in 2023?", answer: "New Delhi" },
  { question: "Which city hosted the G20 Summit in 2024?", answer: "Rio De Janerio, Brazil" },
  { question: "Which city will host the G20 Summit in 2025?", answer: "Nasrec, Johannesburg, South Africa" },
  { question: "What is the name of India's mission to study the Sun launched in 2023?", answer: "Aditya-L1" },
  { question: "Who is the current President of India?", answer: "Droupadi Murmu" },
  { question: "Which Indian state recently became the first to implement a Uniform Civil Code?", answer: "Uttarakhand" },
  { question: "Which country won the FIFA World Cup in 2022?", answer: "Argentina" },
  { question: "Who holds the record for the fastest century in T20 International cricket?", answer: "David Miller" },
  { question: "Which Indian athlete won a gold medal in javelin throw at the Tokyo 2020 Olympics?", answer: "Neeraj Chopra" },
  { question: "Who won the 2024 Nobel Prize in Literature?", answer: "Han Kang" },
  { question: "Who won the 2023 Nobel Prize in Literature?", answer: "Jon Fosse" },
  { question: "Which organization was awarded the 2024 Nobel Peace Prize?", answer: "Nihon Hidankyo" },
  { question: "Who was awarded the 2023 Nobel Peace Prize?", answer: "Narges Mohammadi" },
  { question: "Who were the recipients of the 2023 Nobel Prize in Physics?", answer: "Pierre Agostini, Ferenc Krausz and Anne L'Huillier" },
  { question: "Who were the recipients of the 2024 Nobel Prize in Physics?", answer: "John J. Hopfield, Geoffry Hinton" },
  { question: "When was the first Nobel Prize for Physics awared?", answer: "1901" },
  { question: "Which school awarded the 2024 Nobel Prize for Physics?", answer: "Royal Swedish Academy of Sciences, Stockholm, Sweden" },
  { question: "Who won the 59th Jnanpith Award in 2024?", answer: "Vinod Kumar Shukla" },
  { question: "Who was the first Assamese person to win the Jnanpith Award(1979)", answer: "Birendra Kumar Bhattacharya" },
  { question: "How many times has the Jnanpith Award been conferred upon Assamese writers?", answer: "Three times" },
  { question: "What is Operation Sindoor about?", answer: "Ram Mandir inauguration security and ritual operation" },
  { question: "What is the derivative of sin(x)?", answer: "cos(x)" },
  { question: "What is the square root of 144?", answer: "12" },
  { question: "What is the chemical symbol for gold?", answer: "Au" },
  { question: "What is H2SO4 commonly known as?", answer: "Sulfuric Acid" },
  { question: "What does DNA stand for?", answer: "Deoxyribonucleic Acid" },
  { question: "What does POK stand for?", answer: "Pakistan Occupied Kashmir" },
  { question: "What does LOC stand for in the context of India-Pakistan relations?", answer: "Line of Control" },
  { question: "When was the Ram Mandir inaugurated in Ayodhya?", answer: "22 January 2024" },
  { question: "Where is the newly constructed Ram Mandir located?", answer: "Ayodhya, Uttar Pradesh" },
  { question: "Which Indian temple was inaugurated by Prime Minister Modi in January 2024?", answer: "Ram Mandir" },
  { question: "What is Sunita Williams' full name?\n\na) Sunita Lyn Williams\nb) Sunita Patel Williams\nc) Sunita Reddy Williams\nd) Sunita Sharma Williams", answer: "a" },
  { question: "In which year was Sunita Williams born?\n\na) 1960\nb) 1965\nc) 1970\nd) 1975", answer: "b" },
  { question: "What is Sunita Williams' connection to India?\n\na) She was born in India\nb) Her father was Indian\nc) She studied in India\nd) She worked in India before joining NASA", answer: "b" },
  { question: "Which branch of the U.S. military did Sunita Williams serve in before becoming an astronaut?\n\na) U.S. Army\nb) U.S. Coast Guard\nc) U.S. Air Force\nd) U.S. Navy", answer: "d" },
  { question: "In which year was Sunita Williams selected as a NASA astronaut?\n\na) 1993\nb) 1998\nc) 2001\nd) 2005", answer: "b" },
  { question: "In which year did Sunita Williams become the commander of the International Space Station?\n\na) 2005\nb) 2007\nc) 2012\nd) 2015", answer: "c" },
  { question: "Which sport did Sunita Williams famously run while in space?\n\na) Marathon\nb) Swimming race\nc) Cycling race\nd) Sprint race", answer: "a" },
  { question: "Which spacecraft will Sunita Williams pilot in her upcoming space mission?\n\na) SpaceX Dragon\nb) Boeing Starliner\nc) Orion Capsule\nd) Blue Origin New Shepard", answer: "b" },
  { question: "Sunita Williams has been honoured with which prestigious space award?\n\na) Bharat Ratna\nb) NASA Space Flight Medal\nc) Nobel Prize in Physics\nd) Padma Bhushan", answer: "b" },
  { question: "During which mission did Sunita Williams set a record for the longest spaceflight by a woman at the time?\n\na) STS-116\nb) STS-121\nc) Expedition 14/15\nd) Expedition 22/23", answer: "c" }
];

function fuzzyMatch(input, answer) {
  const normalize = (str) =>
    str.toLowerCase().replace(/[^a-z0-9 ]/g, "").replace(/\s+/g, " ").trim();

  const a = normalize(input);
  const b = normalize(answer);
  if (!a) return false;
  if (a === b) return true;

  const distance = (s1, s2) => {
    const dp = Array(s1.length + 1).fill(null).map(() => Array(s2.length + 1).fill(0));
    for (let i = 0; i <= s1.length; i++) dp[i][0] = i;
    for (let j = 0; j <= s2.length; j++) dp[0][j] = j;
    for (let i = 1; i <= s1.length; i++) {
      for (let j = 1; j <= s2.length; j++) {
        const cost = s1[i - 1] === s2[j - 1] ? 0 : 1;
        dp[i][j] = Math.min(
          dp[i - 1][j] + 1,
          dp[i][j - 1] + 1,
          dp[i - 1][j - 1] + cost
        );
      }
    }
    return dp[s1.length][s2.length];
  };

  const dist = distance(a, b);
  return dist <= 3 || a.includes(b) || b.includes(a);
}

export default function QuizApp() {
  const [currentIndex, setCurrentIndex] = useState(Math.floor(Math.random() * questions.length));
  const [userAnswer, setUserAnswer] = useState("");
  const [isCorrect, setIsCorrect] = useState(null);
  const [score, setScore] = useState(0);
  const [questionsAnswered, setQuestionsAnswered] = useState(0);
  const [showAnswer, setShowAnswer] = useState(false);
  const [answeredIndices, setAnsweredIndices] = useState([]);

  const checkAnswer = () => {
    if (showAnswer) return;
    const trimmedAnswer = userAnswer.trim();
    if (trimmedAnswer === "") return;
    const correct = fuzzyMatch(trimmedAnswer, questions[currentIndex].answer);
    setIsCorrect(correct);
    if (correct) setScore(score + 1);
    setQuestionsAnswered(questionsAnswered + 1);
    setShowAnswer(true);
    setAnsweredIndices([...answeredIndices, currentIndex]);
  };

  const nextQuestion = () => {
    const remainingIndices = questions
      .map((_, index) => index)
      .filter(index => !answeredIndices.includes(index));

    if (remainingIndices.length === 0) return;

    const newIndex = remainingIndices[Math.floor(Math.random() * remainingIndices.length)];
    setCurrentIndex(newIndex);
    setUserAnswer("");
    setIsCorrect(null);
    setShowAnswer(false);
  };

  const revealAnswer = () => {
    if (!answeredIndices.includes(currentIndex)) {
      setQuestionsAnswered(questionsAnswered + 1);
      setAnsweredIndices([...answeredIndices, currentIndex]);
    }
    setShowAnswer(true);
  };

  const restartQuiz = () => {
    setScore(0);
    setQuestionsAnswered(0);
    setAnsweredIndices([]);
    setCurrentIndex(Math.floor(Math.random() * questions.length));
    setUserAnswer("");
    setIsCorrect(null);
    setShowAnswer(false);
  };

  const getProgressColor = () => {
    const colors = ["from-red-500", "from-yellow-500", "from-green-500", "from-blue-500", "from-purple-500"];
    return colors[score % colors.length];
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center p-4">
      <Card className="w-full max-w-xl text-center">
        <CardContent className="space-y-4">
          <h2 className="text-xl font-bold">Quiz Time</h2>
          <div className="relative w-full h-2 rounded-full bg-gray-200 overflow-hidden">
            <div
              className={`absolute top-0 left-0 h-full transition-all duration-300 bg-gradient-to-r ${getProgressColor()} to-transparent`}
              style={{ width: `${(questionsAnswered / questions.length) * 100}%` }}
            />
          </div>
          <p className="text-sm text-gray-500">Score: {score} / {questions.length}</p>

          {questionsAnswered < questions.length ? (
            <>
              <p className="text-lg font-medium">{questions[currentIndex].question}</p>
              <Input
                value={userAnswer}
                onChange={(e) => setUserAnswer(e.target.value)}
                placeholder="Your answer"
                className="w-full"
                disabled={showAnswer}
              />
              <div className="flex flex-col gap-2 sm:flex-row sm:justify-center">
                <Button onClick={checkAnswer} disabled={showAnswer}>Submit</Button>
                {!showAnswer && (
                  <Button variant="outline" onClick={revealAnswer}>Reveal Answer</Button>
                )}
                {showAnswer && (
                  <Button variant="secondary" onClick={nextQuestion}>Next</Button>
                )}
              </div>
              {showAnswer && (
                <p className={`text-sm font-semibold ${isCorrect ? "text-green-600" : "text-red-600"}`}>
                  {isCorrect ? "Correct!" : `Wrong. Correct Answer: ${questions[currentIndex].answer}`}
                </p>
              )}
            </>
          ) : (
            <>
              <p className="text-lg font-semibold">Quiz Complete! Final Score: {score} / {questions.length}</p>
              <Button className="mt-2" onClick={restartQuiz}>Restart Quiz</Button>
            </>
          )}
        </CardContent>
      </Card>
    </div>
  );
}
